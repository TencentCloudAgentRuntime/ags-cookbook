# SWE-Agent with AGS Integration Example

This example demonstrates how to integrate AgentSandbox sandbox into SWE-agent tasks, implementing the complete workflow of "reading SWE instances → remotely starting code sandbox environment → model reasoning in sandbox → generating trajectories".

## Features
- Sandbox isolation, safe and reliable, fast deployment
- SWE-agent automated reasoning process

## Core Concepts

```
┌─────────────────┐    ┌─────────────────┐    ┌──────────────────┐
│   SWE-Agent     │────│SWE-ReX(modified)│────│   Tencent AGS    │
│                 │    │                 │    │                  │
│ • Agent Logic   │    │ • AGSRuntime    │    │ • SandboxTool    │
│ • Task Execution│    │ • AGSDeployment │    │ • SandboxInstance│
└─────────────────┘    └─────────────────┘    └──────────────────┘
```

## Quick Start

### 1. Use Modified SWE-ReX
Download the official SWE-agent project and replace the SWE-ReX code with the modified version from this example to support AGS sandbox integration.

```bash
git clone https://github.com/SWE-agent/SWE-agent.git
cp -r SWE-ReX ./SWE-agent/
cd SWE-agent

cat > ./fix_pyproject_dependency.patch << EOF
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -57,7 +57,7 @@ dependencies = [
     "litellm",
     "GitPython",
     "ghapi",
-    "swe-rex>=1.4.0",
+    "swe-rex @ file://$(pwd)/SWE-ReX",
     "tabulate",
     "textual>=1.0.0",
     "requests",
EOF
git apply ./fix_pyproject_dependency.patch
uv venv
uv pip install -e .
uv run sweagent b --help_option swerex.deployment.config.TencentAGSDeploymentConfig
```

### 2. Configure Model API Parameters

```bash
cat > local_model.yaml << EOF
agent:
  model:
    name: zai/glm-4.6
    api_key: xxx
    api_base: http://ip:port/v1
  tools:
    enable_bash_tool: true
EOF
```

### 3. Set AGS API Key
```bash
cat > .env << EOF
TENCENTCLOUD_SECRET_ID=AKIDxxxx
TENCENTCLOUD_SECRET_KEY=Skxxx
TENCENTCLOUD_ROLE_ARN=qcs::xxx
EOF
```

### 4. Configure Task Parameters

```bash
cat > instances.yaml << EOF
instances:
  type: swe_bench
  subset: lite
  split: test
  deployment:
    type: tencentags
    http_endpoint: ags.tencentcloudapi.com
    region: ap-chongqing
    domain: ap-chongqing.tencentags.com
    tool_id: ""
    mount_name: rex
    mount_image: tencentcloudcr.com/example/swerex-runtime:1.4.0
    mount_image_registry_type: enterprise
    mount_path: /nix
    image_subpath: /nix
    mount_readonly: false
EOF
```
It is recommended to load the SWE ReX runtime image into the AGS sandbox through mounting (mount_image) for faster startup. It is recommended to use the warming interface provided by Tencent AGS to warm up the SWE-related images in advance to reduce the startup time.

### 5. Run

```bash
uv run sweagent run-batch \
    --config ./local_model.yaml \
    --config config/default.yaml \
    --config ./instances.yaml \
    --num_workers 1
```

During runtime, the AGS sandbox environment will be started using the SWE instance corresponding image, then execute commands generated by the model in the sandbox, and finally output trajectory results.

## Technical Highlights
- Highly customizable sandbox environment
- Automated resource management and cleanup
- Fast integration into existing SWE-agent workflow

## Extensions
You can view the conceptual details in the modified SWE-ReX project, read the relevant code, and learn more about calling details.